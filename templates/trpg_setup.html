<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        .topicBtn {
            background-color: #f4f4f4;
            /* Light grey */
            border: 1px solid #ccc;
            outline: none;
        }

        .topicBtn.selected {
            background-color: #4CAF50;
            /* Green */
            color: white;
            border-color: #4CAF50;
        }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRPG Session Setup</title>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('playerCount').addEventListener('change', function () {
                const playerSection = document.getElementById('playerSection');
                playerSection.innerHTML = ''; // Clear previous inputs
                const numberOfPlayers = parseInt(this.value, 10);

                for (let i = 1; i <= numberOfPlayers; i++) {
                    const playerInput = document.createElement('div');
                    playerInput.innerHTML = `
                <label for="player${i}Name">Player ${i} Name:</label>
                <input type="text" id="player${i}Name" name="player${i}Name">
                <label for="player${i}Phone">Phone:</label>
                <input type="tel" id="player${i}Phone" name="player${i}Phone">
            `;
                    playerSection.appendChild(playerInput);
                }
            });
        });

        function selectTopic(topic) {
            // Set the hidden input value
            document.getElementById('selectedTopic').value = topic;

            // Get all buttons with the class 'topicBtn'
            var buttons = document.getElementsByClassName('topicBtn');

            // Remove the 'selected' class from all buttons
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('selected');
            }

            // Add the 'selected' class to the clicked button
            document.getElementById('btn' + topic.replace(/\s+/g, '')).classList.add('selected');
        }

        function submitForm() {
            const topic = document.getElementById('selectedTopic').value;
            const playerCount = document.getElementById('playerCount').value;

            const formData = new FormData();
            formData.append('selectedTopic', topic);
            formData.append('playerCount', playerCount);

            for (let i = 1; i <= playerCount; i++) {
                formData.append(`player${i}Name`, document.getElementById(`player${i}Name`).value);
                formData.append(`player${i}Phone`, document.getElementById(`player${i}Phone`).value);
            }

            fetch('/submit', {
                method: 'POST',
                body: formData,
            })
                .then(response => {
                    if (response.redirected) {
                        window.location.href = response.url;
                    } else {
                        window.location.href = '/game';
                    }
                })
                .then(data => console.log(data))
                .catch(error => console.error('Error:', error));


        }

    </script>
</head>

<body>

    <h2>Select TRPG Topic</h2>
    <button id="btnFantasy" class="topicBtn" onclick="selectTopic('Fantasy')">Fantasy</button>
    <button id="btnSciFi" class="topicBtn" onclick="selectTopic('Sci-Fi')">Sci-Fi</button>
    <button id="btnHorror" class="topicBtn" onclick="selectTopic('Horror')">Horror</button>
    <button id="btnAdventure" class="topicBtn" onclick="selectTopic('Adventure')">Adventure</button>
    <button id="btnMystery" class="topicBtn" onclick="selectTopic('Mystery')">Mystery</button>

    <!-- <button onclick="document.getElementById('selectedTopic').value='Fantasy'">Fantasy</button>
    <button onclick="document.getElementById('selectedTopic').value='Sci-Fi'">Sci-Fi</button>
    <button onclick="document.getElementById('selectedTopic').value='Horror'">Horror</button>
    <button onclick="document.getElementById('selectedTopic').value='Adventure'">Adventure</button>
    <button onclick="document.getElementById('selectedTopic').value='Mystery'">Mystery</button> -->
    <input type="hidden" id="selectedTopic" name="selectedTopic">

    <div>
        <label for="playerCount">Number of Players:</label>
        <input type="number" id="playerCount" name="playerCount" min="1" max="10">
    </div>

    <div id="playerSection">
        <!-- Player inputs will be added here -->
    </div>

    <button onclick="submitForm()">Submit</button>

</body>

</html>